<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>Dave Clicker</title>
<style>
body {
  background: linear-gradient(to right, #ffcc00, #ff6600);
  font-family: 'Arial', sans-serif;
  margin: 0;
  padding: 20px;
  text-align: center;
  color: #fff;
  position: relative;
  min-height: 100vh;
  overflow-x: hidden; 
}
#hubBtn {
  position: absolute;
  top: 10px;
  left: 10px;
  background: rgba(0,0,0,0.3);
  color: white;
  text-decoration: none;
  padding: 8px 15px;
  border-radius: 5px;
  font-size: 0.9em;
  border: 1px solid #fff;
}
h1 { font-size: 2em; margin-top: 40px; margin-bottom: 5px; }
#highscore-display { font-size: 1em; color: #ffe066; margin-bottom: 10px; font-weight: bold; }

#dave {
  width: 250px;
  cursor: pointer;
  border-radius: 20px;
  border: 5px solid #fff;
  box-shadow: 0 0 20px #fff;
  transition: transform 0.1s;
  user-select: none;
  -webkit-tap-highlight-color: transparent;
}
#dave:active { transform: scale(0.95); }

#stats { margin-top: 20px; font-size: 1.1em; }
#money { font-size: 2.2em; font-weight: bold; display: block; }

#upgrades {
  margin-top: 20px;
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
}
button {
  background: #fff;
  color: #ff6600;
  border: none;
  padding: 10px 20px;
  margin: 10px;
  border-radius: 10px;
  font-weight: bold;
  cursor: pointer;
  box-shadow: 0 0 10px rgba(0,0,0,0.2);
}
.building {
  background: rgba(255,255,255,0.2);
  border-radius: 10px;
  padding: 15px;
  margin: 10px;
  flex: 1 1 200px;
  max-width: 250px;
}
#resetButton {
  position: fixed;
  bottom: 10px;
  right: 10px;
  font-size: 0.7em;
  opacity: 0.6;
}
.flying-coin { pointer-events: none; z-index: 999; font-size: 1.5em; position: fixed; }
</style>
</head>
<body>

<a href="https://davescasino.github.io/davescasino" id="hubBtn">‚Üê Back to Hub</a>

<h1>Dave Coins</h1>
<div id="highscore-display">All-Time Highscore: <span id="highscore">0</span></div>

<img src="https://i.imgur.com/1UfrW92.png" id="dave" alt="Dave" />

<div id="stats">
  <div id="money">0</div>
  <div>Coins per Click: <span id="perClick">1</span></div>
  <div>Auto Coins/sec: <span id="autoCoins">0</span></div>
  <hr style="width:30%; border: 0.5px solid rgba(255,255,255,0.3)">
  <div>Multiplier: x<span id="prestigeMultiplier">1</span></div>
</div>

<div id="buildings"></div>

<div id="upgrades">
  <button id="clickUpgrade">Better Fingers ($10)</button>
  <button id="autoUpgrade">Auto-Clicker ($50)</button>
  <button id="prestigeBtn">Prestige (Cost: <span id="prestigeThreshold">1000</span>)</button>
</div>

<button id="resetButton">Hard Reset Game</button>

<script>
// LOAD DATA OR INITIALIZE
let data = JSON.parse(localStorage.getItem('daveCoinsSave')) || {
  money: 0,
  highscore: 0,
  coinsPerClick: 1,
  autoCoinsPerSec: 0,
  prestigeMultiplier: 1,
  prestigeCount: 0,
  prestigeThreshold: 1000,
  buildings: {
    farmer: { count: 0, cost: 10, unlocked: false },
    tractor: { count: 0, cost: 100, unlocked: false },
  }
};

const buildingTypes = [
  { key: 'farmer', name: 'Amish Farmer', rate: 1, unlockPrestige: 1 },
  { key: 'tractor', name: 'Orange Tractor', rate: 10, unlockPrestige: 2 },
];

function save() {
  localStorage.setItem('daveCoinsSave', JSON.stringify(data));
}

function updateUI() {
  // Update Highscore logic
  if (data.money > data.highscore) {
    data.highscore = Math.floor(data.money);
  }

  document.getElementById('money').innerText = Math.floor(data.money).toLocaleString();
  document.getElementById('highscore').innerText = data.highscore.toLocaleString();
  document.getElementById('perClick').innerText = data.coinsPerClick;
  document.getElementById('autoCoins').innerText = (getTotalAutoIncome()).toFixed(1);
  document.getElementById('prestigeMultiplier').innerText = data.prestigeMultiplier;
  document.getElementById('prestigeThreshold').innerText = data.prestigeThreshold.toLocaleString();
  
  document.getElementById('clickUpgrade').innerText = `Better Fingers ($${Math.round(10 * Math.pow(1.5, data.coinsPerClick - 1))})`;
  document.getElementById('autoUpgrade').innerText = `Auto-Clicker ($${Math.round(50 * Math.pow(1.5, data.autoCoinsPerSec))})`;
  
  updateBuildingsUI();
}

function getTotalAutoIncome() {
  let buildingIncome = 0;
  for (const b of buildingTypes) {
    const bData = data.buildings[b.key];
    if (bData.unlocked) buildingIncome += bData.count * b.rate;
  }
  return (data.autoCoinsPerSec + buildingIncome) * data.prestigeMultiplier;
}

// CLICK LOGIC
document.getElementById('dave').addEventListener('click', (e) => {
  data.money += (data.coinsPerClick * data.prestigeMultiplier);
  spawnCoin(e.clientX, e.clientY);
  updateUI();
  save(); // Save on click for safety
});

function spawnCoin(x, y) {
  const coin = document.createElement('div');
  coin.className = 'flying-coin';
  coin.innerText = 'ü™ô';
  coin.style.left = x + 'px';
  coin.style.top = y + 'px';
  document.body.appendChild(coin);

  const destX = x + (Math.random() - 0.5) * 200;
  const destY = y - 200;

  coin.animate([
    { transform: 'translate(0, 0) scale(1)', opacity: 1 },
    { transform: `translate(${destX - x}px, ${destY - y}px) scale(1.5)`, opacity: 0 }
  ], { duration: 800, easing: 'ease-out' }).onfinish = () => coin.remove();
}

// UPGRADES
document.getElementById('clickUpgrade').onclick = () => {
  let cost = Math.round(10 * Math.pow(1.5, data.coinsPerClick - 1));
  if (data.money >= cost) {
    data.money -= cost;
    data.coinsPerClick++;
    updateUI();
    save();
  }
};

document.getElementById('autoUpgrade').onclick = () => {
  let cost = Math.round(50 * Math.pow(1.5, data.autoCoinsPerSec));
  if (data.money >= cost) {
    data.money -= cost;
    data.autoCoinsPerSec++;
    updateUI();
    save();
  }
};

document.getElementById('prestigeBtn').onclick = () => {
  if (data.money >= data.prestigeThreshold) {
    data.prestigeMultiplier++;
    data.prestigeCount++;
    data.money = 0;
    data.coinsPerClick = 1;
    data.autoCoinsPerSec = 0;
    for (let key in data.buildings) {
        data.buildings[key].count = 0;
    }
    data.prestigeThreshold = Math.round(data.prestigeThreshold * 3);
    checkUnlocks();
    updateUI();
    save();
  } else {
    alert("You need " + (data.prestigeThreshold - Math.floor(data.money)) + " more coins!");
  }
};

function buyBuilding(key) {
  const bData = data.buildings[key];
  if (data.money >= bData.cost) {
    data.money -= bData.cost;
    bData.count++;
    bData.cost = Math.round(bData.cost * 1.2);
    updateUI();
    save();
  }
}

function updateBuildingsUI() {
  const container = document.getElementById('buildings');
  container.innerHTML = '';
  buildingTypes.forEach(b => {
    const bData = data.buildings[b.key];
    if (bData.unlocked) {
      const div = document.createElement('div');
      div.className = 'building';
      div.innerHTML = `
        <h3>${b.name}</h3>
        <p>Owned: ${bData.count}</p>
        <button onclick="buyBuilding('${b.key}')">Buy ($${bData.cost})</button>
      `;
      container.appendChild(div);
    }
  });
}

function checkUnlocks() {
  buildingTypes.forEach(b => {
    if (data.prestigeCount >= b.unlockPrestige) data.buildings[b.key].unlocked = true;
  });
}

// GAME LOOPS
setInterval(() => {
  data.money += (getTotalAutoIncome() / 10);
  updateUI();
}, 100);

setInterval(save, 10000); // Autosave every 10 seconds just in case

document.getElementById('resetButton').onclick = () => {
  if (confirm("ERASE ALL PROGRESS AND HIGHSCORE?")) {
    localStorage.removeItem('daveCoinsSave');
    location.reload();
  }
};

// INITIALIZE
checkUnlocks();
updateUI();
</script>
</body>
</html>
