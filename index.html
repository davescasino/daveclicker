<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>Dave Coins Idle Game</title>
<style>
body {
  background: linear-gradient(to right, #ffcc00, #ff6600);
  font-family: 'Arial', sans-serif;
  margin: 0;
  padding: 20px;
  text-align: center;
  color: #fff;
  overflow-x: hidden; /* Prevents side-scrolling on mobile */
}
#dave {
  width: 250px;
  cursor: pointer;
  border-radius: 20px;
  border: 5px solid #fff;
  box-shadow: 0 0 20px #fff;
  transition: transform 0.05s;
  user-select: none;
  -webkit-tap-highlight-color: transparent; /* Removes the blue box on mobile tap */
}
#dave:active { transform: scale(0.95); }

/* Faster, Smoother CSS Animations */
.coin-animation {
  position: fixed;
  pointer-events: none;
  z-index: 999;
  font-size: 24px;
  animation: flyUp 0.8s ease-out forwards;
}
@keyframes flyUp {
  0% { transform: translate(0, 0) scale(1); opacity: 1; }
  100% { transform: translate(var(--tw), -200px) scale(1.5); opacity: 0; }
}

#stats { margin-top: 20px; font-size: 1.1em; }
#money { font-size: 2.2em; font-weight: bold; }
button {
  background: #fff; color: #ff6600; border: none; padding: 12px 20px;
  margin: 8px; border-radius: 10px; font-weight: bold; cursor: pointer;
}
.building { background: rgba(255,255,255,0.2); border-radius: 10px; padding: 10px; margin: 10px; }
#resetButton { position: fixed; bottom: 10px; right: 10px; opacity: 0.7; }
</style>
</head>
<body>

<h1>Dave Coins</h1>
<img src="https://i.imgur.com/1UfrW92.png" id="dave" alt="Dave" />

<div id="stats">
  <div id="money-display">$<span id="money">0</span></div>
  <div>Per Click: <span id="perClick">1</span></div>
  <div>Auto/sec: <span id="autoCoins">0</span></div>
  <hr style="width:50%; border: 0.5px solid rgba(255,255,255,0.3)">
  <div>Prestige: x<span id="prestigeMultiplier">1</span></div>
</div>

<div id="buildings"></div>
<div id="upgrades">
  <button id="clickUpgrade">Better Fingers ($10)</button>
  <button id="autoUpgrade">Auto-Clicker ($50)</button>
  <button id="prestigeBtn">Prestige</button>
</div>
<button id="resetButton">Reset</button>

<script>
let data = JSON.parse(localStorage.getItem('daveCoinsData')) || {
  money: 0, coinsPerClick: 1, autoCoinsPerSec: 0,
  prestigeMultiplier: 1, prestigeCount: 0,
  buildings: {
    farmer: { count: 0, cost: 10, unlocked: false },
    tractor: { count: 0, cost: 100, unlocked: false },
  }
};

const buildingTypes = [
  { key: 'farmer', name: 'Amish Farmer', rate: 1, unlockPrestige: 1 },
  { key: 'tractor', name: 'Orange Tractor', rate: 10, unlockPrestige: 2 },
];

function save() { localStorage.setItem('daveCoinsData', JSON.stringify(data)); }

function updateUI() {
  document.getElementById('money').innerText = Math.floor(data.money).toLocaleString();
  document.getElementById('perClick').innerText = (data.coinsPerClick * data.prestigeMultiplier).toFixed(1);
  document.getElementById('autoCoins').innerText = (getTotalAutoIncome()).toFixed(1);
  document.getElementById('prestigeMultiplier').innerText = data.prestigeMultiplier;
  
  // Render Buildings
  const container = document.getElementById('buildings');
  container.innerHTML = '';
  buildingTypes.forEach(b => {
    const bData = data.buildings[b.key];
    if (data.prestigeCount >= b.unlockPrestige) {
      const div = document.createElement('div');
      div.className = 'building';
      div.innerHTML = `<strong>${b.name}</strong> (${bData.count})<br>
                       Cost: $${bData.cost} | <button onclick="buyBuilding('${b.key}')">Buy</button>`;
      container.appendChild(div);
    }
  });
}

function getTotalAutoIncome() {
  let bIncome = 0;
  buildingTypes.forEach(b => {
    bIncome += (data.buildings[b.key].count * b.rate);
  });
  return (data.autoCoinsPerSec + bIncome) * data.prestigeMultiplier;
}

// Logic to give coins
function handleDaveClick(e) {
  // Prevent ghost clicks on mobile
  if (e.type === 'touchstart') e.preventDefault();
  
  data.money += (data.coinsPerClick * data.prestigeMultiplier);
  
  // Visuals
  const touch = e.touches ? e.touches[0] : e;
  spawnCoin(touch.clientX, touch.clientY);
  updateUI();
}

function spawnCoin(x, y) {
  const coin = document.createElement('div');
  coin.className = 'coin-animation';
  coin.innerText = 'ðŸª™';
  coin.style.left = x + 'px';
  coin.style.top = y + 'px';
  coin.style.setProperty('--tw', (Math.random() * 100 - 50) + 'px');
  document.body.appendChild(coin);
  setTimeout(() => coin.remove(), 800);
}

// Attach both events for max compatibility
const daveImg = document.getElementById('dave');
daveImg.addEventListener('touchstart', handleDaveClick, {passive: false});
daveImg.addEventListener('click', handleDaveClick);

window.buyBuilding = (key) => {
  const b = data.buildings[key];
  if (data.money >= b.cost) {
    data.money -= b.cost;
    b.count++;
    b.cost = Math.round(b.cost * 1.2);
    updateUI();
    save();
  } else { alert("Not enough coins!"); }
};

document.getElementById('clickUpgrade').onclick = () => {
  if (data.money >= 10) { data.money -= 10; data.coinsPerClick++; updateUI(); save(); }
};

document.getElementById('autoUpgrade').onclick = () => {
  if (data.money >= 50) { data.money -= 50; data.autoCoinsPerSec++; updateUI(); save(); }
};

document.getElementById('prestigeBtn').onclick = () => {
  if (data.money >= 1000) {
    data.prestigeMultiplier += Math.floor(data.money / 1000);
    data.prestigeCount++;
    data.money = 0;
    data.coinsPerClick = 1;
    data.autoCoinsPerSec = 0;
    Object.keys(data.buildings).forEach(k => data.buildings[k].count = 0);
    updateUI();
    save();
  } else { alert("Need $1000 to prestige!"); }
};

document.getElementById('resetButton').onclick = () => {
  if(confirm("Reset everything?")) { localStorage.clear(); location.reload(); }
};

// Auto Loop (10 times a second for smoothness)
setInterval(() => {
  data.money += (getTotalAutoIncome() / 10);
  updateUI();
}, 100);

// Auto Save every 5 seconds
setInterval(save, 5000);

updateUI();
</script>
</body>
</html>
